<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Game - ❄️ Blizzard ❄️</title>
        <!-- Custom HTML head -->
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="../favicon.svg">
        <link rel="shortcut icon" href="../favicon.png">
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        <link rel="stylesheet" href="../css/print.css" media="print">
        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../fonts/fonts.css">
        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../highlight.css">
        <link rel="stylesheet" href="../tomorrow-night.css">
        <link rel="stylesheet" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->
    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded "><a href="../overview.html"><strong aria-hidden="true">1.</strong> Overview</a></li><li class="chapter-item expanded "><a href="../roadmap.html"><strong aria-hidden="true">2.</strong> Roadmap</a></li><li class="chapter-item expanded "><a href="../getting_started.html"><strong aria-hidden="true">3.</strong> Getting started</a></li><li class="chapter-item expanded "><a href="../server.html"><strong aria-hidden="true">4.</strong> Server Architecture</a></li><li class="chapter-item expanded "><a href="../engine.html"><strong aria-hidden="true">5.</strong> Engine Architecture</a></li><li class="chapter-item expanded "><a href="../learn.html"><strong aria-hidden="true">6.</strong> Learn</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../learn/world.html"><strong aria-hidden="true">6.1.</strong> World</a></li><li class="chapter-item expanded "><a href="../learn/ec.html"><strong aria-hidden="true">6.2.</strong> Entities and Components</a></li><li class="chapter-item expanded "><a href="../learn/systems.html"><strong aria-hidden="true">6.3.</strong> Systems</a></li><li class="chapter-item expanded "><a href="../learn/game.html" class="active"><strong aria-hidden="true">6.4.</strong> Game</a></li><li class="chapter-item expanded "><a href="../learn/server.html"><strong aria-hidden="true">6.5.</strong> Server</a></li><li class="chapter-item expanded "><a href="../learn/client.html"><strong aria-hidden="true">6.6.</strong> Client</a></li></ol></li><li class="chapter-item expanded "><a href="../origin.html"><strong aria-hidden="true">7.</strong> Origin</a></li><li class="chapter-item expanded "><a href="../dev_process.html"><strong aria-hidden="true">8.</strong> Development Process</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">❄️ Blizzard ❄️</h1>

                    <div class="right-buttons">
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="game"><a class="header" href="#game">Game</a></h1>
<p>The <code>Game</code> is in charge of setting up the <code>World</code>'s initial state, defining how to update the <code>World</code>, define global resources / state, setting up the input, and defining when the game should end.</p>
<p>To create your own <code>Game</code>, it must be imported from the engine:</p>
<pre><code>use blizzard_engine::game::Game;
</code></pre>
<h2 id="creating-a-game"><a class="header" href="#creating-a-game">Creating a Game</a></h2>
<p><code>Game</code> is a trait. You can define your own game struct and implement this trait and also Clone:</p>
<pre><code>#[derive(Clone)]
struct MyGame {
    world: MyWorld,
    counter: i32,
}

impl Game&lt;SharedState, Input&gt; for MyGame {
    fn world_config(&amp;mut self) {

    }

    fn update(&amp;mut self, input: Input, shared_state: Arc&lt;Mutex&lt;SharedState&gt;&gt;) {

    }

    fn reset_input(&amp;mut self, input: Arc&lt;Mutex&lt;Input&gt;&gt;) {
    }

    fn render(&amp;mut self) {}

    fn end_game(&amp;self) -&gt; bool {
        false
    }
}
</code></pre>
<p>The struct <code>MyGame</code> has the world. We also defined another property called counter, just to show that you can create and customize your game however you wish.</p>
<p>The <code>Game</code> trait has two generic types, the first is <code>K</code>. <code>K</code> is used for sharing information with the client, it is a way to define which data is sent off to the client. For now, we defined the generic <code>K</code> as a struct called <code>SharedState</code>. We will talk about the shared state later. For now, let's define it as an emtpy struct:</p>
<pre><code>#[derive(Debug, Serialize, Deserialize, Clone)]
pub struct SharedState {
}

impl SharedState {
    pub fn new() -&gt; Self {
        Self {
        }
    }
}
</code></pre>
<p>The shared state must implement these traits, hence we need to add <code>Serde</code> to our proyect in order to serialize/deserialize the data sent. At the top of the file add the following:</p>
<pre><code>#[macro_use]
extern crate serde_derive;
extern crate serde;
extern crate serde_json;
</code></pre>
<p>The second generic type is <code>I</code> which was used before, we defined it as the <code>Input</code> tuple struct.</p>
<p>If the function signatures are confusing, here is the generic definition:</p>
<pre><code>pub trait Game&lt;K, I&gt; {
    fn world_config(&amp;mut self);
    fn update(&amp;mut self, input: I, shared_state: Arc&lt;Mutex&lt;K&gt;&gt;);
    fn reset_input(&amp;mut self, input: Arc&lt;Mutex&lt;I&gt;&gt;);
    fn render(&amp;mut self);
    fn end_game(&amp;self) -&gt; bool;
}
</code></pre>
<p>Let's talk about each function and implement it in our game.</p>
<h2 id="world-configuration"><a class="header" href="#world-configuration">World Configuration</a></h2>
<p>The world configuration function is the first function to be called when starting the game. It is useful to define initial states, entities and components. This function is only called once, at the beginning of the <code>Game</code> lifecycle.</p>
<p>Let's define a basic initial entity with a counter component:</p>
<pre><code>fn world_config(&amp;mut self) {
    // Create counter entity
    let entities = self.world.entity_manager.create_n_entities(1);

    // Add components to many entities
    self.world.counters.add_many(&amp;entities, 0);
}
</code></pre>
<h2 id="updating-the-world"><a class="header" href="#updating-the-world">Updating the world</a></h2>
<p>After the world configuration is run, the game loop is started. The update function is the first function that is called in the game loop. It takes an argument of the input, however we are not using it now.</p>
<pre><code>fn update(&amp;mut self, input: Input, shared_state: Arc&lt;Mutex&lt;SharedState&gt;&gt;) {
    // Update components
    self.world.run_systems(input);
    self.counter += 1;
}
</code></pre>
<p>This function should be used to tell the <code>World</code> to run it's systems.</p>
<h2 id="reseting-user-input"><a class="header" href="#reseting-user-input">Reseting user input</a></h2>
<p>After the update function is called, the reset_input function is called. For now we can leave it empty, but it is just a way to define how the input for the next loop should look like if no client input is detected.</p>
<pre><code>fn reset_input(&amp;mut self, input: Arc&lt;Mutex&lt;Input&gt;&gt;) {
}
</code></pre>
<h2 id="render"><a class="header" href="#render">Render</a></h2>
<p>This function is called after updating and reseting the user input. It is meant to be called for rendering the game, however the engine does not have a Renderer API yet, so it is pretty much useless:</p>
<pre><code>fn render(&amp;mut self) {}
</code></pre>
<h2 id="ending-the-game"><a class="header" href="#ending-the-game">Ending the game</a></h2>
<p>This function determines wheter the game should end or not. Here logic can be inserted to end the game. However, we will create an endless game:</p>
<pre><code>fn end_game(&amp;self) -&gt; bool {
    false
}
</code></pre>
<h2 id="game-creator-helper-function"><a class="header" href="#game-creator-helper-function">Game creator helper function</a></h2>
<p>It is recommended to make a game creator helper function:</p>
<pre><code>fn new_game(world: MyWorld) -&gt; MyGame {
    MyGame {
        counter: 0,
        world: world,
    }
}
</code></pre>
<p>Perfect, we are almost ready to deploy our server, let's learn how to add start a server with this game!</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../learn/systems.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>
                            <a rel="next" href="../learn/server.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>
                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../learn/systems.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>
                    <a rel="next" href="../learn/server.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>

        <script type="text/javascript">
            window.playground_copyable = true;
        </script>
        <script src="../elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../searcher.js" type="text/javascript" charset="utf-8"></script>
        <script src="../clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="../book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
    </body>
</html>
